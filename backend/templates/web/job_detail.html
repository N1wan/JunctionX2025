{% extends 'layouts/base.html' %}
{% load static %}

{% block title %}Job {{ job.id }}{% endblock %}

{% block content %}
<div class="row">
  <div class="col-lg-9 mx-auto">
    <div class="card shadow-sm">
      <div class="card-body">
        <h1 class="h4 mb-3">Job details</h1>

        <dl class="row">
          <dt class="col-sm-3">Status</dt>
          <dd class="col-sm-9">
            {% if job.status == "SUCCESS" %}
              <span class="badge bg-success">SUCCESS</span>
            {% elif job.status == "FAILED" %}
              <span class="badge bg-danger">FAILED</span>
            {% elif job.status == "RUNNING" %}
              <span class="badge bg-secondary">RUNNING</span>
            {% else %}
              <span class="badge bg-secondary">{{ job.status }}</span>
            {% endif %}
          </dd>

          <dt class="col-sm-3">Original file</dt>
          <dd class="col-sm-9">{{ job.original_name|default:"—" }}</dd>

          <dt class="col-sm-3">Stored file</dt>
          <dd class="col-sm-9">{{ job.stored_name|default:"—" }}</dd>

          <dt class="col-sm-3">Uploaded path</dt>
          <dd class="col-sm-9"><code>{{ job.upload_rel|default:job.upload_path }}</code></dd>

          <dt class="col-sm-3">Normalized WAV</dt>
          <dd class="col-sm-9"><code>{{ job.normalized_rel|default:job.normalized_path|default:"—" }}</code></dd>

          <dt class="col-sm-3">Sizes</dt>
          <dd class="col-sm-9">
            src: {{ job.src_size|default:"?" }} bytes,
            wav: {{ job.wav_size|default:"?" }} bytes
          </dd>

          <dt class="col-sm-3">Duration</dt>
          <dd class="col-sm-9">{{ job.duration_sec|default:"—" }} s</dd>

          {% if job.error %}
          <dt class="col-sm-3">Error</dt>
          <dd class="col-sm-9 text-danger">{{ job.error }}</dd>
          {% endif %}
        </dl>

        {% if ok %}
          <hr />
          <h5>Transcript</h5>
          <pre class="small">{{ job.full_text|default:"(empty)" }}</pre>

          {% if job.labels %}
            <h5 class="mt-3">Labels</h5>
            <ul>
              {% for lbl in job.labels %}
                <li><code>{{ lbl.0 }}</code>: {{ lbl.1 }}</li>
              {% endfor %}
            </ul>
          {% endif %}
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
