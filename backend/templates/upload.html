{% load static %}
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Upload & Analyze</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body{font-family: system-ui, sans-serif; max-width: 800px; margin: 2rem auto; padding: 0 1rem;}
    header{margin-bottom:1rem}
    form{border:1px solid #ddd; padding:1rem; border-radius:8px; margin-bottom:1rem;}
    pre{background:#111; color:#eee; padding:1rem; border-radius:8px; overflow:auto;}
    .meta{font-size:.95rem; background:#f6f6f6; padding:.75rem; border-radius:6px;}
    .error{color:#b00020;}
  </style>
</head>
<body>
<header>
  <h1>Upload audio/video → normalize → mock ASR</h1>
  <p>This MVP accepts audio or video, converts to mono 16k WAV, mocks ASR, and shows metadata.</p>
</header>

{% if messages %}
  <ul>
    {% for m in messages %}
      <li class="{% if m.tags %}{{ m.tags }}{% endif %}">{{ m }}</li>
    {% endfor %}
  </ul>
{% endif %}

<form method="post" enctype="multipart/form-data">
  {% csrf_token %}
  <label>Choose file (audio or video): </label>
  <input type="file" name="file" accept="audio/*,video/*" required>
  <button type="submit">Analyze</button>
</form>

{% if ok %}
  <section class="meta">
    <div><strong>Upload saved:</strong> {{ upload_path }}</div>
    <div><strong>Normalized WAV:</strong> {{ normalized_path }}</div>
    <div><strong>Input size:</strong> {{ src_size }} bytes</div>
    <div><strong>WAV size:</strong> {{ wav_size }} bytes</div>
    <div><strong>Duration:</strong> {{ length_sec }} s</div>
  </section>

  <h3>Mock transcript JSON</h3>
  <pre>{{ transcript|safe }}</pre>
{% endif %}

</body>
</html>
